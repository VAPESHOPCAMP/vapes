<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ADMIN | V4PESHOPCAMP</title>
    <style>
        body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
        .container { max-width: 800px; background: white; padding: 20px; border-radius: 10px; margin: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input, button { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; cursor: pointer; font-weight: bold; }
        .sabor-input { display: flex; gap: 10px; margin-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        .badge-regalo { background: gold; padding: 4px 8px; border-radius: 50%; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <h2>Panel Administrador V4PESHOPCAMP</h2>
    
    <div id="auth" style="background:#eee; padding:15px; border-radius:10px;">
        <h3>Agregar Nuevo Producto</h3>
        <input type="text" id="modelo" placeholder="Modelo (Ej: Waka SoPro 10k)">
        <input type="number" id="precio" placeholder="Precio ($)">
        <input type="text" id="imagen" placeholder="URL de la imagen (Link)">
        
        <h4>Sabores y Stock</h4>
        <div id="lista-sabores-inputs">
            <div class="sabor-input">
                <input type="text" placeholder="Sabor" class="nom-sabor">
                <input type="number" placeholder="Stock" class="cant-sabor" style="width:100px;">
            </div>
        </div>
        <button onclick="otroSabor()" style="background:#28a745;">+ AÃ±adir otro sabor</button>
        <button onclick="guardarProducto()" style="background:#000;">SUBIR A LA TIENDA</button>
    </div>

    <hr>
    <h3><i class="fas fa-gift"></i> Rastreo de Clientes y Regalos</h3>
    <table id="tabla-clientes">
        <thead>
            <tr>
                <th>Cliente / Tel</th>
                <th>Vapes para Regalo</th>
                <th>Regalos Entregados</th>
            </tr>
        </thead>
        <tbody id="cuerpo-clientes"></tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC-vNy_58D_ZKhnS0PAKFQGwlnsk3vnKzU",
  authDomain: "v4peshop.firebaseapp.com",
  projectId: "v4peshop",
  storageBucket: "v4peshop.firebasestorage.app",
  messagingSenderId: "981333518832",
  appId: "1:981333518832:web:a0d5b9f73fea8b81365535",
  measurementId: "G-K6DF2DCCRQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.otroSabor = () => {
        const div = document.createElement('div');
        div.className = 'sabor-input';
        div.innerHTML = `<input type="text" placeholder="Sabor" class="nom-sabor"><input type="number" placeholder="Stock" class="cant-sabor" style="width:100px;">`;
        document.getElementById('lista-sabores-inputs').appendChild(div);
    };

    window.guardarProducto = () => {
        const mod = document.getElementById('modelo').value;
        const pre = document.getElementById('precio').value;
        const img = document.getElementById('imagen').value;
        const n = document.querySelectorAll('.nom-sabor');
        const c = document.querySelectorAll('.cant-sabor');
        let sab = {};
        n.forEach((el, i) => { if(el.value) sab[el.value] = parseInt(c[i].value); });

        if(mod && pre && Object.keys(sab).length > 0) {
            push(ref(db, 'productos'), { modelo: mod, precio: parseInt(pre), imagen: img, sabores: sab })
            .then(() => { alert("Guardado"); location.reload(); });
        } else { alert("Faltan datos"); }
    };

    onValue(ref(db, 'clientes'), (snapshot) => {
        const data = snapshot.val();
        const tbody = document.getElementById('cuerpo-clientes');
        tbody.innerHTML = "";
        for(let tel in data) {
            const c = data[tel];
            tbody.innerHTML += `<tr>
                <td><b>${c.nombre}</b><br>${tel}</td>
                <td>${c.vapesComprados} / 5</td>
                <td><span class="badge-regalo">${c.regalosDados || 0}</span></td>
            </tr>`;
        }
    });
</script>
</body>
</html>